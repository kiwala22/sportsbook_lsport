<div class="clear-slip" onclick="localStorage.removeItem('stake')"><%= link_to  "Remove All", clear_slip_path , remote: true, method: :delete %></div>
<div class="bets" id = "bets-row" data-controller = "slips">
   <% if !@cart.nil? && @cart.line_bets.present?  %>
      <% @cart.line_bets.each do |bet| %>
            <% if fetch_market_status(bet.market, bet.fixture_id) == "Active" %>
               <div class="row">
                 <div class="col-12">
                   <div class="single-bet">
                     <div class="col-1"><%= link_to '<i class="far fa-window-close"></i>'.html_safe, clear_bet_path(id: bet.id), remote: true, method: :delete %></div>
                      <div id="comp-names" class="col-9"><span> <%= bet.fixture.comp_one_name %> - <%= bet.fixture.comp_two_name %> </span><span> <%= bet.description %></span></div>
                      <div id='odd4' data-target="slips.odd" class="col-2 float-right"><%= fetch_current_odd(bet.market, bet.fixture_id, bet.outcome) %></div>
                   </div>
                 </div>
               </div>
            <% end %>
      <% end %>
      <% if user_signed_in? %>
         <%= form_with(url: bet_slips_path, method: "post", remote: true) do %>
         <div class="row">
           <div class="col-12">
              <div class="total-bet">
                <span class="col-8" data-action="keyup->slips#calculate_win" data-target="slips.stake" > <%= text_field_tag :stake, nil, placeholder: " Stake Amount" ,id: "stake-input", class: "" %> </span>
                <span class="col-4" id="total-odds" data-target="slips.total"><%= @cart.line_bets.pluck(:odd).map(&:to_f).inject(:*).round(2) unless @cart.line_bets.count == 0  %></span>
              </div>
           </div>
         </div>
         <div class="row">
           <div class="col-12">
             <div class="total-wins">
                <span class="col-4">Payout</span>
                <span class="col-8" id="total-wins" data-target="slips.wins"> </span>
             </div>
           </div>
         </div>
         <%= hidden_field_tag(:cart_id, @cart.id) %>
         <div class="actions" onclick="localStorage.removeItem('stake')">
            <%= button_tag "Place Bet", class: "btn btn-block btn-primary mt-lg login-btn", id:'place_bet', data: {disable_with: "<i class='fas fa-spinner fa-spin'></i> Placing Bet..."}  %>
         </div>
         <% end %>
      <% else %>
         <div class="total-bet">
            <span class="col-8" data-action="keyup->slips#calculate_win" data-target="slips.stake" > <%= text_field_tag :stake, nil, placeholder: " Stake Amount" ,id: "stake-input", class: "" %> </span>
            <span class="col-4" id="total-odds" data-target="slips.total"><%= @cart.line_bets.pluck(:odd).map(&:to_f).inject(:*).round(2) unless @cart.line_bets.count == 0  %></span>
         </div>
         <div class="total-wins">
            <span>Payout</span>
            <span id="total-wins" data-target="slips.wins"> </span>
         </div>
         <%= link_to "Login", new_user_session_path,  method: "get", class: "btn btn-block btn-primary mt-lg login-btn", id:'slip_login',data: {disable_with: "<i class='fas fa-spinner fa-spin'></i> Redirecting to Login page..."}  %>
      <% end %>

   <% end %>
</div>
