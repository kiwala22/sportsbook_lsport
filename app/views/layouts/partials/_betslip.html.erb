<div class="clear-slip" onclick="localStorage.removeItem('stake')"><%= link_to  "Remove All", clear_slip_path , remote: true, method: :delete %></div>
<div class="bets" id = "bets-row" data-controller = "slips">
   <% if !@cart.nil? && @cart.line_bets.present?  %>
      <% @cart.line_bets.each do |bet| %>
            <% if fetch_market_status(bet.market, bet.fixture_id) == "Active" %>
               <div class="single-bet">
                  <span id="comp-names"><span> <%= bet.fixture.comp_one_name %> - <%= bet.fixture.comp_two_name %> </span><span> <%= bet.description %></span></span>
                  <span id='odd4' data-target="slips.odd"><%= fetch_current_odd(bet.market, bet.fixture_id, bet.outcome) %></span>
               </div>
            <% end %>
      <% end %>
      <% if user_signed_in? %>
         <%= form_with(url: bet_slips_path, method: "post", remote: true) do %>
         <div class="total-bet">
            <span data-action="keyup->slips#calculate_win" data-target="slips.stake" > <%= text_field_tag :stake, nil, placeholder: " Stake Amount" ,id: "stake-input" %> </span>
            <span id="total-odds" data-target="slips.total"><%= @cart.line_bets.pluck(:odd).map(&:to_f).inject(:*).round(2) unless @cart.line_bets.count == 0  %></span>
         </div>
         <div class="total-wins">
            <span>Possible Win Amount</span>
            <span id="total-wins" data-target="slips.wins"> </span>
         </div>
         <%= hidden_field_tag(:cart_id, @cart.id) %>
         <div clas="actions">
            <%= button_tag "Place Bet", class: "btn btn-block btn-primary mt-lg login-btn", id:'place_bet', data: {disable_with: "<i class='fas fa-spinner fa-spin'></i> Placing Bet..."}  %>
         </div>
         <% end %>
      <% else %>
         <div class="total-bet">
            <span data-action="keyup->slips#calculate_win" data-target="slips.stake" > <%= text_field_tag :stake, nil, placeholder: " Stake Amount" ,id: "stake-input", required: true %> </span>
            <span id="total-odds" data-target="slips.total"><%= @cart.line_bets.pluck(:odd).map(&:to_f).inject(:*).round(2) unless @cart.line_bets.count == 0  %></span>
         </div>
         <div class="total-wins">
            <span>Payout</span>
            <span id="total-wins" data-target="slips.wins"> </span>
         </div>
         <%= link_to "Login", new_user_session_path,  method: "get", class: "btn btn-block btn-primary mt-lg login-btn", id:'slip_login',data: {disable_with: "<i class='fas fa-spinner fa-spin'></i> Redirecting to Login page..."}  %>
      <% end %>

   <% end %>
</div>
